var excludeMobileRedirect = ["/fifaworldcup/organisation/ticketing/", "/worldcup/organisation/ticketing/"];define(['frameworks/bundle'],function () {;(function($,w,d) {var thumblistModel=fifa.model.extend({initialize:function(options) {var _this=this;fifa.model.prototype.initialize.apply(_this,[options]);var _onHashChange=function(e) {e.preventDefault();if(w.disable_hashchange_evt) {return;}_this.setPhoto();};$(w).bind('hashchange',_onHashChange);},onInit:function() {var _this=this;_this.selectedPhotoId=false;_this.setPhoto();},setPhoto:function() {var _this=this,hash=w.location.hash;if(!hash) {_this.selectedPhotoId=false;_this.triggerView('hidePhoto');return;}var photoId=hash.substr(1);if(isNaN(photoId)) {_this.selectedPhotoId=false;_this.triggerView('hidePhoto');return;}if(photoId) {_this.selectedPhotoId=photoId;_this.triggerView('showPhoto',photoId);}},onTogglePhoto:function(id) {var _this=this;if(_this.selectedPhotoId!==id) {w.location.hash='#' + id;}else {_this.selectedPhotoId=false;var scr=document.body.scrollTop;w.location.hash='';history.pushState('',d.title,w.location.pathname);d.body.scrollTop=scr;}},name:'thumblist',view_name:'thumblist:view'});w.models.thumblist=new thumblistModel({bind:['togglePhoto','init']});}(window.jQuery||window.jm,window,document));;(function($,w,d) {var thumblistView=fifa.view.extend({lisInRow:1,$html_body:null,initialize:function(options) {var _this=this;fifa.view.prototype.initialize.apply(_this,[options]);_this.$html_body=$(navigator.userAgent.indexOf('WebKit/')===-1 ? 'html':'body');_this.$el.find('.dcm-thumblist:first .dcm-thumblist-item').each(function() {var $this=$(this);if($this.prev().length>0) {if($this.position().top!=$this.prev().position().top) { return false;}_this.lisInRow++;}});_this.$sourceLayout=_this.$el.find('>.ph-str-selected-wrapper');_this.fullPicLis={};_this.thumbsLis={};_this.activeLi=false;_this.triggerModel('init');},events:{'click .dcm-thumblist':'toggleOpenPhoto'},toggleOpenPhoto:function(e) {var _this=this,id=false;e.preventDefault();if(e.target.nodeName.toLowerCase()=='img') {id=$(e.target).attr('ph-data-picture-id');}else {id=$(e.target).find('img[ph-data-picture-id]').attr('ph-data-picture-id');}if(id) {this.triggerModel('togglePhoto',id);}},hidePhoto:function() {var _this=this;if(_this.activeLi) {_this.fullPicLis[_this.activeLi]=_this.fullPicLis[_this.activeLi].remove();_this.thumbsLis[_this.activeLi].removeClass('active');_this.activeLi=false;}},onHidePhoto:function() {this.hidePhoto();},showPhoto:function(id) {var _this=this,$fullPicLi=_this.fullPicLis[id].removeClass('hidden'),$thumbLi=_this.thumbsLis[id].addClass('active');_this.activeLi=id;var sourceIdx=$thumbLi.index(),insertIdx=Math.min((Math.floor(sourceIdx / _this.lisInRow) + 1) * _this.lisInRow,$thumbLi.siblings().size() + 1),scrollTop=-1;$thumbLi.closest('ul').find('.dcm-thumblist-item:eq(' + (insertIdx - 1) + ')').after($fullPicLi);scrollTop=($thumbLi.offset().top - fifa.getSiteHeaderHeight());if(scrollTop!==_this.$html_body.scrollTop()) {_this.$html_body.animate({scrollTop:scrollTop},0);}fifa.dispatcher.trigger('analytics:photoView',id);googletag.cmd.push(function() {googletag.pubads().refresh();});},getFullPicLi:function() {var _this=this;return _this.$('.ph-str-wrapper.ph-inpage').length ? _this.$('.ph-str-wrapper.ph-inpage'):$('<li/>',{ 'class':'ph-str-wrapper ph-inpage'}).append(_this.$sourceLayout.clone());},ext_xhr:null,getExternalImage:function(id) {var _this=this,cached_key=['photos',id].join(''),cached_photo=fifa.cacheMap.get(cached_key),setImageCallback=function(data) {if(!data) { return;}fifa.cacheMap.set(cached_key,data);var $data=$(data);if(!$data.length) { return;}var photo_obj=$data[0],orientation=photo_obj.isLandscape==='1' ? 'landscape':'portrait',$fullPicLi=_this.getFullPicLi(),$img=$fullPicLi.find('img,.ph-str-selected-i').removeClass('portrait landscape').addClass(orientation),mmurls=photo_obj.MMURLs,img=new Image(),img_src,i,l=mmurls.length;for (i=0; i<l; i++) {var obj=mmurls[i];for (var p in obj) {if(p==='MMURL_BIG-LND'||p==='MMURL_FULL-PRT') {img_src=obj[p];break;}}if(img_src) {break;}}img.onload=function() {$fullPicLi.find('.ph-str-selected-wrapper').removeClass('hidden');$img.attr('src',img.src);$img.fadeIn();};$fullPicLi.find('.ph-str-selected-copyright>span').text(photo_obj.wNewsCopyrightName);$fullPicLi.find('.ph-str-selected-title').text(photo_obj.DisplayHeadline);$fullPicLi.find('.ph-str-selected-comment').html(photo_obj.DisplaySummary);$fullPicLi.find('.ph-str-selected-date').addClass('hidden');img.src=['//img.fifa.com','/mm',img_src].join('');_this.$('.dcm-thumblist-item:nth-child(4):first').after($fullPicLi);fifa.dispatcher.trigger('analytics:photoView',id);googletag.cmd.push(function() {googletag.pubads().refresh();});};if(cached_photo) {setImageCallback(cached_photo);return;}if(_this.ext_xhr) { _this.ext_xhr.abort();}_this.ext_xhr=$.ajax({type:'get',url:'/_inc/photos/photo={0}.html'.format(id),dataType:'json',success:setImageCallback});},onShowPhoto:function(id) {var _this=this;this.hidePhoto();if(!_this.fullPicLis[id]) {var $thumbImg=_this.$el.find('img[ph-data-picture-id=' + id + ']'),orientation=$thumbImg.attr('ph-data-picture-orientation');if(!$thumbImg.length) {_this.getExternalImage(id);return;}var $thumbLi=$thumbImg.closest('.dcm-thumblist-item'),$fullPicLi=_this.getFullPicLi(),$img=$fullPicLi.find('img,.ph-str-selected-i').removeClass('portrait landscape').addClass(orientation),img=new Image();img.onload=function() {$fullPicLi.find('.ph-str-selected-wrapper').removeClass('hidden');$img.attr('src',img.src);$img.fadeIn();};$fullPicLi.find('.ph-str-selected-copyright>span').text($thumbImg.attr('ph-data-picture-copyright'));$fullPicLi.find('.ph-str-selected-title').text($thumbImg.attr('ph-data-picture-title'));$fullPicLi.find('.ph-str-selected-comment').html($thumbImg.attr('ph-data-picture-comment'));$fullPicLi.find('.ph-str-selected-date').removeClass('hidden').text($thumbImg.attr('ph-data-picture-date'));img.src=$thumbImg.attr('ph-data-picture-url').htmlDecode(true);_this.thumbsLis[id]=$thumbLi;_this.fullPicLis[id]=$fullPicLi;}_this.showPhoto(id);},editorialViewOnPaginationInit:function() {this.setElement(__cfg.el);},name:'thumblist:view',model_name:'thumblist'}),__cfg={el:'.dcm-list.list-photos:not(.nojs)',bind:['hidePhoto','showPhoto','editorial:view:paginationInit']};w.views.thumblist=new thumblistView(__cfg);}(window.jQuery||window.jm,window,document)); });
